= render 'component/organizations/detail/header'
%section#detail-info
	%header
		%h1.name
			= superscript_ordinals(@org.name)
		- if @org.agency.present?
			%h2.agency
				= @org.agency

	- if 	@org.street_address.present? || @org.phones.present? || @org.urls.present?

		%section.contact-box
			%h1 
				%span Contact

			- if @org.street_address.present?
				%div.address
					%span{"data-icon"=>"✉" , :class=>"ohana-icon"}
					%span{:itemtype=>"http://schema.org/PostalAddress",:itemprop=>"address"}
						%span{:itemprop=>"streetAddress"}
							= superscript_ordinals(@org.street_address) 
						%br 
						%span{:itemprop=>"addressLocality"}
							= @org.city+","
						%span{:itemprop=>"addressRegion"}
							= @org.state
						%span{:itemprop=>"postalCode"}
							= @org.zipcode

			- if @org.phones.present?
				%div.phone
					- @org.phones.each do |array|
						-	array.each do |hash|
							%span{"data-icon"=>"☎" , :class=>"ohana-icon"}
							- if hash["department"]
								%span 
									= "#{hash["department"]}" 
							- if hash["number"]
								%span{:itemprop=>"telephone"}
									= "#{format_phone(hash["number"])}" 
							- if hash["phone_hours"]		
								%span
									= " #{hash["phone_hours"]}"	
							%br

			- if @org.faxes.present?
				%div.fax
					- @org.faxes.each do |fax|
						%span{"data-icon"=>"℻" , :class=>"ohana-icon"}
						%span{:itemprop=>"faxNumber"}
							= "#{format_phone(fax)}"
						%br

			- if @org.urls.present?
				%div.url
					- @org.urls.each do |url|
						%a{:href=>url,:target=>"_blank"}
							%span{"data-icon"=>"🔗" , :class=>"external-link ohana-icon"}
							%span{:itemprop=>"url"}
								= url
							%br

	- if @org.contact_people.present? || @org.ask_for.present? || @org.emails.present?
		%section.contacts-box
			%h1
				- if @org.contact_people.present? && @org.contact_people.length > 0
					%span Primary Contacts
				- else
					%span Primary Contact
			
			- if @org.contact_people.present?
				%div.contacts
					- @org.contact_people.each_with_index do |contact|
						%span
							= contact

			- if @org.ask_for.present?
				%div.ask-for
					= @org.ask_for

			- if @org.emails.present?
				%div.email{:itemprop=>"email"}
					- @org.emails.each do |email|
						%span{"data-icon"=>"@" , :class=>"ohana-icon"}
						%span{:itemprop=>"email"}
							= email
						%br

	- if @org.service_hours.present? 
		%section.hours-box
			%h1
				%span Service Hours

			- if @org.service_hours.present?
				%div.service-hours
					= @org.service_hours

			- if @org.service_wait.present?
				%div.service-wait
					%span{"data-icon"=>"⧗" , :class=>"time ohana-icon"}
					Wait time:
					= @org.service_wait

	- if @org.payments_accepted.present? || @org.products_sold.present?
		%section.payment-box
			%h1
				%span Payment & Products

			- if @org.payments_accepted.present?
				%div.payments-accepted
					%span{"data-icon"=>"$" , :class=>"payment ohana-icon"}
					Payment methods accepted:
					%ul
						-@org.payments_accepted.sort.each do |payment|
							%li
								%span.term-popup-container
									%span.popup.hide
										- dynamic_partial = 'component/popup/'+payment.downcase
										= render :partial => "#{dynamic_partial}" rescue nil
									%span.popup-term
										= payment

			- if @org.market_match?
				%div.market-match
					This market participates in 
					%span.term-popup-container
						%span.popup.hide
							= render :partial => 'component/popup/marketmatch' rescue nil
						%span.popup-term
							Market Match!

			- if @org.products_sold.present?
				%div.products-sold
					%span{"data-icon"=>"␣" , :class=>"ohana-icon"}
					Products sold: 
					%ul
						- @org.products_sold.sort.each do |product|
							%li 
								= product


	- if @org.description.present? || @org.accessibility_options.present? || @org.how_to_apply.present? ||@org.fees.present? || @org.languages_spoken.present?
		%section.overview-box
			%h1
				%span Service Overview

			- if @org.description.present?
				%div.description
					= @org.description

			- if @org.how_to_apply.present?
				%div.how-to-apply
					%span{"data-icon"=>"?" , :class=>"ohana-icon"}
					How to Apply: 
					%ul
						= @org.how_to_apply

			- if @org.fees.present?
				%div.fees
					%span{"data-icon"=>"$" , :class=>"ohana-icon"}
					Fees: 
					%ul
						= @org.fees

			- if @org.languages_spoken.present?
				%div.languages-spoken
					%span{"data-icon"=>"L" , :class=>"ohana-icon"}
					Languages Spoken: 
					%ul
						- @org.languages_spoken.sort.each do |lang|
							%li 
								= lang

			- if @org.accessibility_options.present?
				%div.accessibility-options
					%span{"data-icon"=>"♿" , :class=>"ohana-icon"}
					Accessibility Options: 
					%ul
						- @org.accessibility_options.sort.each do |access|
							%li
								= access
						- if @org.ttys.present?
							%li
								- @org.ttys.each do |tty|
									%span
										TDD/TTY:
										= "#{format_phone(tty)}"
									%br

			

	- if @map_url.present? || @org.transportation_availability.present?
		%section.map-box
			%h1 
				%span Map & Directions

			- if @org.transportation_availability.present?
				%div.transportation
					%span 
						= @org.transportation_availability

			- if @map_url.present?
				%div.directions
					%a{:href=>"https://maps.google.com/maps?saddr=current+location&daddr=#{@org.address}",:target=>"_blank"}
						%span{"data-icon"=>"🔗" , :class=>"external-link ohana-icon"}
						%span Get Directions

				%div.map
					%img{:src=>"#{@map_url}", :alt => "Location map", :width => 320, :height => 240, :title => "#{@org.address}"}
-#
	// field dump
	- @org.each do |field|
		%section
			%h1
			= field
			

- if @nearby.present?
	%h2
		Nearby (within 2 miles):
	%ul
		- @nearby.each do |venue| 
			%li
				%a{:href=>"#{organization_path(venue)}", :title=>"#{venue.name}"}
					%section{:class => "results-entry"}
						%h1.name
							= superscript_ordinals(venue.name)
						%p.address
							= superscript_ordinals(venue.street_address)+", #{venue.city}, #{venue.state} #{venue.zipcode}"